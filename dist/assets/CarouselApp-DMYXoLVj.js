import{R as F,t as C,G as de,M as I,C as V,u as X,S as ue,H as fe,m as he,f as we,g as ge,A as pe,j as me,h as xe,W as ke,O as ye,Q as Se,E as ve,V as Me,d as be,o as O,q as j,s as Be,r as U,c as Ee,n as Le}from"./animation-B9tawhAX.js";import{l as Re,a as Te}from"./index-DWYs1AIc.js";function Pe(t){const e=t.filter(l=>l.shelf==="currently-reading").length,n=t.filter(l=>l.shelf==="to-read").length,r=t.filter(l=>l.shelf==="read"||!l.shelf&&l.date_read),o=r.length;t.length;const a=r.map(l=>l.date_read||l.date_added||l.year).filter(l=>l);let i=new Date().getFullYear(),d=i;if(a.length>0){const l=a.map(H=>new Date(H).getFullYear()).filter(H=>!isNaN(H));l.length>0&&(i=Math.min(...l),d=Math.max(...l))}const m=.35*2.25,u=.25*2.25,f=.008*1.5,g=.15,b=new F(u,m,f,4,.01),G=new F(g,m,f,4,.01),R=.01*1.5,K=u-R,ee=m-.02*1.5,te=g-f*2,ne=new F(K,ee,te,4,.005),oe=Ce(),ie=Ie(e,n,o,i,d),ae=De(),z={roughness:.8,metalness:.1},re=new C({map:oe,...z}),se=new C({map:ie,...z}),ce=new C({map:ae,...z}),le=new C({color:16645111,roughness:.9,metalness:0}),S=new de,T=new I(b,re);T.position.z=g/2,T.castShadow=!0,T.receiveShadow=!0,S.add(T);const B=new I(b,se);B.position.z=-g/2,B.rotation.y=Math.PI,B.castShadow=!0,B.receiveShadow=!0,S.add(B);const E=new I(G,ce);E.position.x=-u/2,E.rotation.y=-Math.PI/2,E.castShadow=!0,E.receiveShadow=!0,S.add(E);const P=new I(ne,le);return P.position.x=R*.5,P.castShadow=!0,P.receiveShadow=!0,S.add(P),S.userData={id:"intro",title:"Vik's Library",isIntro:!0},S}function Ce(){const t=document.createElement("canvas");t.width=512,t.height=800;const e=t.getContext("2d"),n=t.width,r=t.height;e.fillStyle="#2c3e50",e.fillRect(0,0,n,r),e.strokeStyle="#d4a373",e.lineWidth=10,e.strokeRect(20,20,n-40,r-40),e.textAlign="center";let o=300;e.fillStyle="#fdfbf7",e.font='bold 90px "Cormorant Garamond", serif',e.fillText("Vik's",n/2,o),o+=110,e.fillStyle="#d4a373",e.font='90px "Dancing Script", cursive',e.fillText("Library",n/2,o),o+=150,e.strokeStyle="rgba(255,255,255,0.3)",e.beginPath(),e.moveTo(n*.3,o),e.lineTo(n*.7,o),e.stroke();const a=new V(t);return a.colorSpace=X,a}function Ie(t,e,n,r,o){const a=document.createElement("canvas");a.width=512,a.height=800;const i=a.getContext("2d"),d=a.width,m=a.height;i.fillStyle="#2c3e50",i.fillRect(0,0,d,m),i.strokeStyle="#d4a373",i.lineWidth=10,i.strokeRect(20,20,d-40,m-40),i.textAlign="center";let u=150;const f=(G,R)=>{i.fillStyle="#d4a373",i.font='30px "Montserrat", sans-serif',i.fillText(G.toUpperCase(),d/2,u),u+=80,i.fillStyle="#fdfbf7",i.font='bold 60px "Cormorant Garamond", serif',i.fillText(R.toString(),d/2,u),u+=100};f("Currently Reading",t),f("To Read",e),f("Read",n),u+=50,i.fillStyle="rgba(255,255,255,0.6)",i.font='italic 30px "Cormorant Garamond", serif';let g=`${r}`;r!==o&&(g+=` - ${o}`),i.fillText(`Est. ${g}`,d/2,u);const b=new V(a);return b.colorSpace=X,b}function De(){const t=document.createElement("canvas");t.width=128,t.height=800;const e=t.getContext("2d");e.fillStyle="#1a252f",e.fillRect(0,0,128,800),e.fillStyle="#d4a373",e.fillRect(0,50,128,20),e.fillRect(0,730,128,20);const n=new V(t);return n.colorSpace=X,n}let p,h,v,x,$,s=[],c=0,w=!1,_,Q=!1,k=0,Y=0,L=0,W=!1,D={x:0,y:0};window.currentBookMesh=null;const M=document.getElementById("app"),A=document.getElementById("ui-controls");function Ve(){if(w){Z();return}if(w=!0,M&&M.classList.remove("hidden"),A&&A.querySelectorAll(".nav-btn:not(.view-toggle)").forEach(n=>n.classList.remove("hidden")),Q){q(),Z();return}p=new ue,$=new Le,new fe().setPath("").load("environment.hdr",function(n){n.mapping=he,p.environment=n}),we(p),ge(p);const t=new pe(16777215,.5);p.add(t);const e=new me(16777215,1);e.position.set(5,10,7),p.add(e),h=new xe(75,window.innerWidth/window.innerHeight,.1,1e3),h.position.set(0,1.5,Ge()),h.lookAt(0,1.5,0),v=new ke({antialias:!0}),v.setSize(window.innerWidth,window.innerHeight),M.innerHTML="",M.appendChild(v.domElement),x=new ye(h,v.domElement),x.enableDamping=!0,x.enableZoom=!1,x.enableRotate=!1,x.enablePan=!1,We(),Ue(),Q=!0,q()}function Xe(){w=!1,cancelAnimationFrame(_),M&&M.classList.add("hidden"),A&&A.querySelectorAll(".nav-btn:not(.view-toggle)").forEach(t=>t.classList.add("hidden"))}function We(){new URLSearchParams(window.location.search).get("book")==="0"||Promise.all([Re(),document.fonts.ready]).then(([n])=>{const r=Te(n);Ae(r,n)})}function Ae(t,e=[]){s=[];const n=Pe(e.length>0?e:t);n.position.set(0,0,0),p.add(n),s.push(n),t.forEach((a,i)=>{const{mesh:d}=Ee(a);p.add(d),s.push(d)}),N();const o=new URLSearchParams(window.location.search).get("book");if(o){const a=s.findIndex(i=>i.userData.id===o);a!==-1&&(c=a)}else c=0;s.length>0&&y(c)}function N(){const t=ze();s.forEach((e,n)=>{const r=n*t;e.position.set(r,0,0)})}function q(){if(!w)return;_=requestAnimationFrame(q);const t=$.getElapsedTime();if(x.update(),Y+=(k-Y)*.05,k+=(.5-k)*.02,typeof O=="function"&&O(t,Y),typeof j=="function"&&j(h),window.currentBookMesh&&!W&&(window.currentBookMesh.userData.baseRotationY=L,Be(window.currentBookMesh,t)),s.length>0&&s[c]){const e=s[c],n=new U(e.position.x,e.position.y,e.position.z+(window.innerWidth<768?2.2:.9));h.position.lerp(n,.05);const r=new U(e.position.x,e.position.y,e.position.z);x.target.lerp(r,.05),window.currentBookMesh=e;const o=window.innerWidth<768,a=o?1.6:1,i=o?.5:.7;s.forEach((d,m)=>{const u=m===c,f=u?a:i;d.scale.lerp(new U(f,f,f),.1);const g=u&&o?1:0;d.position.z+=(g-d.position.z)*.1})}v.render(p,h)}function Ge(){return window.innerWidth<768?1.4:1.2}function ze(){return window.innerWidth<768?.55:1.2}function J(t){if(s.length===0)return;const e=s[t];e&&e.userData&&e.userData.loadTexture&&e.userData.loadTexture()}function He(t,e){let n;return function(...r){const o=this;clearTimeout(n),n=setTimeout(()=>t.apply(o,r),e)}}const Fe=He(t=>J(t),200);function y(t){if(t<0||t>=s.length)return;c=t,L=0;const e=s[t].userData;if(e&&e.id){const n=new URL(window.location);n.searchParams.set("book",e.id),window.history.replaceState(null,"",n),e.title&&(document.title=`Vik's Books | ${e.title}`)}Fe(t)}function Ue(){window.addEventListener("resize",()=>{h.aspect=window.innerWidth/window.innerHeight,h.updateProjectionMatrix(),v.setSize(window.innerWidth,window.innerHeight),N()}),document.addEventListener("keydown",t=>{if(!(!w||s.length===0))switch(t.key){case"ArrowRight":c+1<s.length&&(y(c+1),k=-5);break;case"ArrowLeft":c-1>=0&&(y(c-1),k=5);break;case"ArrowUp":case"ArrowDown":L+=Math.PI;break}}),document.getElementById("nav-left").addEventListener("click",()=>{w&&c-1>=0&&(y(c-1),k=5)}),document.getElementById("nav-right").addEventListener("click",()=>{w&&c+1<s.length&&(y(c+1),k=-5)}),document.addEventListener("mousedown",t=>{w&&(W=!0,D={x:t.clientX,y:t.clientY})}),document.addEventListener("mousemove",t=>{if(!w||!W||!window.currentBookMesh)return;const e={x:t.clientX-D.x,y:t.clientY-D.y},n=new Se().setFromEuler(new ve(0,toRadians(e.x*1),0,"XYZ"));window.currentBookMesh.quaternion.multiplyQuaternions(n,window.currentBookMesh.quaternion),D={x:t.clientX,y:t.clientY}}),document.addEventListener("mouseup",t=>{W=!1}),document.addEventListener("click",t=>{if(!w)return;const e=new Me;e.x=t.clientX/window.innerWidth*2-1,e.y=-(t.clientY/window.innerHeight)*2+1;const n=new be;n.setFromCamera(e,h);const r=n.intersectObjects(s,!0);if(r.length>0){let o=r[0].object;for(;o.parent&&o.parent.type!=="Scene";)o=o.parent;if(window.currentBookMesh&&o===window.currentBookMesh)L+=Math.PI;else{const a=s.indexOf(o);a!==-1&&a!==c&&y(a)}}})}function Z(){const e=new URLSearchParams(window.location.search).get("book");if(e){const n=s.findIndex(r=>r.userData.id===e);n!==-1&&n!==c&&y(n)}else if(c!==0&&(c=0,k=0,L=0,s.length>0)){const n=s[0];x.target.set(n.position.x,n.position.y,n.position.z),h.position.set(n.position.x,n.position.y,n.position.z+1.2),J(0)}}export{Ve as initCarousel,Xe as stopCarousel};
